from flask import Flask, request, jsonify
import openai
import os

app = Flask(__name__)

# ChatGPT API Keyの設定
openai.api_key = os.getenv('OPENAI_API_KEY')

@app.route('/', methods=['GET'])
def home():
    return jsonify({'message': 'Flask is running'})


@app.route('/ask', methods=['POST'])
def ask_date():
    data = request.json
    date = data.get('date')

    # ChatGPT APIの呼び出し
    response = openai.Completion.create(
        model="text-davinci-003",
        prompt=f"What happened on {date} in history?",
        max_tokens=100
    )

    text_response = response.choices[0].text.strip()

    return jsonify({'text': text_response, 'image': None})

if __name__ == '__main__':
    app.run(debug=True)